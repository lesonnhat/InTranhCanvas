<script>
	var productImg_size = {{ product.images.size}};
	var has360 = {{has_360}}, hasVideo = {{has_video}} ;

	function StickerAndPrice(obj, target){		
		var domLoop = $(target);
		var viewed_frame = [0,0,0,0,0];
		//Kiểm tra icon
		var viewed_frame_size = prmt_icon.frame.tag.length;
		//Sticker Frame
		for (var i = 0; i < viewed_frame_size; i++){
			if(prmt_icon.frame.tag[i] != "null"){
				if(obj.tags.includes(prmt_icon.frame.tag[i])){
					viewed_frame[i] = 1;
				}
			}
		}
		$.each(viewed_frame,function(j,k){
			if(k == 1){
				domLoop.find('.proloop-image').append('<div class="sticker_frame"><a href="'+ obj.url +'"><img class="lazyload" src="'+prmt_icon.frame.icon[j]+'" alt="sticker frame"/></a></div>');
				return false;
			}
		});
	}
	var ProductScript = {
		init: function() {
			var that = this;
			that.renderViewedProduct();
			that.expandableDescProduct();
			that.showModalSizeProduct();
			that.faqsProduct();
			that.fancyboxProduct();
		},		
		renderViewedProduct: function(){
			if(jQuery('.productDetail-recently-viewed').length > 0) {
				var d = new Date();
				var n = d.getTime();
				var last_viewed_pro_date = localStorage.getItem('products_viewed_date');
				if (last_viewed_pro_date < n ) {
					localStorage.setItem('products_viewed_date',n + (30*86400000));
					localStorage.removeItem('products_viewed');
				}
				var product_handle = '{{product.handle}}';
				var last_viewed_pro = localStorage.getItem('products_viewed');
				var last_viewed_pro_new = "";
				if(last_viewed_pro == null){
					last_viewed_pro_new = product_handle;
				}
				else{ 
					var list_array = last_viewed_pro.split('##');//[]		
					if(!list_array.includes(product_handle)){
						last_viewed_pro_new = product_handle + '##' + last_viewed_pro;
					}
					else {
						last_viewed_pro_new = list_array.join('##');
					}
				}

				var last_viewd_pro_array = last_viewed_pro_new.split('##');
				var handle_error;	

				var limitpro = last_viewd_pro_array.length;		 
				if(last_viewd_pro_array.length > 8)  limitpro = 8;	
				var recentview_promises = [];
				var countValid = 0;
				for(var i = 0; i < limitpro; i++){		
					if(countValid >=8) return false;
					if(typeof last_viewd_pro_array[i] == 'string'){
						countValid++;
						var promise = new Promise(function(resolve, reject) {
							$.ajax({
								url:'/products/' + last_viewd_pro_array[i] + '?view=viewed',
								success: function(product){
									product = product.trim();
									resolve(product,countValid);
								},
								error: function(err){
									resolve('',countValid);
								}
							})
						});
						recentview_promises.push(promise);
					}
				}

				Promise.all(recentview_promises).then(function(values,countValid) {
					var viewed_items = [];
					$.each(values, function(i, v){
						if(v != ''){
							v = v.replace('viewed-loop-','viewed-loop-'+(i+1));
							$('#listViewed').append(v);
							viewed_items.push(viewed);
							countValid++;
						}
						else{
							viewed_items.push(null);
						}
					});				
					$.each(viewed_items,function(i,v){
						if(v != null){
							StickerAndPrice(v,'#viewed-loop-'+(i+1));
						}
					});
					HRT.Product.sliderProductRelated('#listViewed');
				});		

				var filtered = last_viewd_pro_array.filter(function (el) {
					return el != '';
				});
				localStorage.setItem('products_viewed',filtered.join('##'));
			}
		},
		expandableDescProduct: function(){
      // Luôn hiển thị full mô tả và bỏ nút toggle
      $('.expandable-toggle .description-productdetail')
        .attr('style','')                           // gỡ inline style cũ
        .css({height:'auto', overflow:'visible'});  // mở full
    
      $('.expandable-content_toggle').closest('.description-btn').remove(); // ẩn nút
      $('.expandable-toggle').removeClass('opened');
    },
		showModalSizeProduct: function(){
			$('.btn-size-guide').on('click', function(e){
				e.preventDefault();	
				$('#modal-sizeguide').modal('show'); 
			});
		},
		faqsProduct:function(){
			$('.js-btn-faq').click(function(){
				$(this).hide();
				$(".faq-item").removeClass('d-none');
			});
			$('.product-question .header-faqs').on('click', function(){
				if(!$(this).hasClass('opened')){ 
					jQuery('.product-question .header-faqs').removeClass('opened').parent().find('.content-faqs').stop().slideUp('medium');
					jQuery(this).toggleClass('opened').parent().find('.content-faqs').stop().slideToggle('medium');
				}else{
					jQuery(this).toggleClass('opened').parent().find('.content-faqs').stop().slideToggle('medium');
				}
			});
		},
		fancyboxProduct:function(){
			$('.product-gallery__item[data-fancybox="gallery"]').fancybox({
        protect: true,
        hash : false,
        buttons : ['close'],   // chỉ giữ nút đóng
        arrows: false,         // tắt mũi tên trái/phải
        animationEffect: "zoom",
        infobar : false,
      });
		}
	};
	$(document).ready(function(){
		ProductScript.init();
		if (pro_template == "style_01"){
			if (productImg_size > 1 || (productImg_size >= 1 &&  hasVideo) || (productImg_size == 0 &&  hasVideo) || (productImg_size >= 1 && has360) || (hasVideo && has360)){
				var slider = $('#productCarousel-slider');
				var thumbnailSlider = $('#productCarousel-thumb');
				var duration = 500;	

				slider.owlCarousel({
					items:1,
					nav: true,
					dots: true,
					loop: false,	
					smartSpeed: 1000,
					//touchDrag: false,
					//mouseDrag: false
				})
				slider.on('changed.owl.carousel', function (e) {
					thumbnailSlider.trigger('to.owl.carousel', [e.item.index, duration, true]);
					thumbnailSlider.find(".owl-item").removeClass("current");
					thumbnailSlider.find('.owl-item:nth-child('+ (e.item.index + 1) +')').addClass('current');
				});
				thumbnailSlider.on('initialized.owl.carousel', function() {
					thumbnailSlider.find(".owl-item").eq(0).addClass("current");
				})
				thumbnailSlider.owlCarousel({
					loop:false,	
					nav:false,
					margin:15,
					center:false,
					responsive: {
						0: {
							items: 5,	
						},
						768: {
							items: 5,
						},
						992: {
							items: 6,
						},
						1200: {
							items: 6,
						}
					}
				})
				thumbnailSlider.on('changed.owl.carousel', function (e) {
					slider.trigger('to.owl.carousel', [e.item.index, duration, true]);
					slider.find(".owl-item").removeClass("current");
					slider.find('.owl-item:nth-child('+ (e.item.index + 1) +')').addClass('current');
				});
				thumbnailSlider.on("click", ".owl-item", function(e) {
					e.preventDefault();
					thumbnailSlider.find(".owl-item").removeClass("current");
					$(this).addClass("current");
					var number = $(this).index();
					slider.data('owl.carousel').to(number, duration, true);
				});
			}
		}
		else if(pro_template == "style_02"){
			$('body').scrollspy({
				target: "#productScroll-spy", 
				offset: $('.productDetail-information').offset().top
			});
			$('#productScroll-spy a[href*="#"]').click(function(e){
				e.preventDefault();
				$('#productScroll-spy .product-thumb').removeClass('active');
				$('html, body').animate({
					scrollTop: $($.attr(this, 'href')).offset().top + 20,
				}, 500);		
			});	
			var sliderMobile = $('#productCarousel-slider-mobile');	
			sliderMobile.owlCarousel({
				items:1,
				nav: true,
				dots: true,
				lazyLoad:true,		
				loop: false,	
				smartSpeed: 1000,
				//touchDrag: false,
				//mouseDrag: false
			})
		}
		else if(pro_template == "style_03"){
			if (productImg_size > 1 || (productImg_size >= 1 &&  hasVideo) || (productImg_size == 0 &&  hasVideo) || (productImg_size >= 1 && has360) || (hasVideo && has360)){
				var slickSlider = $('#productSlick-slider');
				var thumbnailSlider = $('#productSlick-thumb');
				slickSlider.slick({
					slidesToShow: 1,
					slidesToScroll: 1,
					arrows: true,
					fade: false,
					infinite: false,
					speed: 1000,
					draggable: false,
					swipe: false,
					asNavFor: '#productSlick-thumb',
					dots: false,
					prevArrow: '<button type="button" data-role="none" class="slick-prev" aria-label="Previous" tabindex="0" role="button"></button>',
					nextArrow: '<button type="button" data-role="none" class="slick-next" aria-label="Next" tabindex="0" role="button"></button>',
				});
				thumbnailSlider.slick({
					slidesToShow: 6,
					slidesToScroll: 1,
					asNavFor: '#productSlick-slider',
					dots: false,
					arrows: false,
					vertical: true,
					verticalSwiping:true,
					infinite: false,
					focusOnSelect: true,
					responsive: [
						{
							breakpoint: 1024,
							settings: {
								slidesToShow: 6,
								slidesToScroll: 6
							}
						},
						{
							breakpoint: 991,
							settings: {
								slidesToShow: 4,
								slidesToScroll: 4,
								vertical: false
							}
						}
					]
				});
				$(document).on('click','#productSlick-thumb .product-thumb__item', function(e){
					e.preventDefault();
					$('#productSlick-thumb .product-thumb').removeClass('slick-current');
					$(this).parent().addClass('slick-current');
				});

			}
		}
		else {
			if (productImg_size > 1 || (productImg_size >= 1 &&  hasVideo) || (productImg_size == 0 &&  hasVideo) || (productImg_size >= 1 && has360) || (hasVideo && has360)){

				var slider = $('#productCarousel-slider');
				var thumbnailSlider = $('#productCarousel-thumb');
				var duration = 500;	
				slider.owlCarousel({
					items:1,
					nav: true,
					dots: true,
					loop: false,	
					smartSpeed: 1000,
					//		touchDrag: false,
					//		mouseDrag: false
				})
				slider.on('changed.owl.carousel', function (e) {
					thumbnailSlider.trigger('to.owl.carousel', [e.item.index, duration, true]);
					thumbnailSlider.find(".owl-item").removeClass("current");
					thumbnailSlider.find('.owl-item:nth-child('+ (e.item.index + 1) +')').addClass('current');
				});
				thumbnailSlider.on('initialized.owl.carousel', function() {
					thumbnailSlider.find(".owl-item").eq(0).addClass("current");
				})
				thumbnailSlider.owlCarousel({
					loop:false,	
					nav:false,
					margin:15,
					center:false,
					responsive: {
						0: {
							items: 5,	
						},
						768: {
							items: 5,
						},
						992: {
							items: 6,
						},
						1200: {
							items: 6,
						}
					}
				})
				thumbnailSlider.on('changed.owl.carousel', function (e) {
					slider.trigger('to.owl.carousel', [e.item.index, duration, true]);
					slider.find(".owl-item").removeClass("current");
					slider.find('.owl-item:nth-child('+ (e.item.index + 1) +')').addClass('current');
				});
				thumbnailSlider.on("click", ".owl-item", function(e) {
					e.preventDefault();
					thumbnailSlider.find(".owl-item").removeClass("current");
					$(this).addClass("current");
					var number = $(this).index();
					slider.data('owl.carousel').to(number, duration, true);
				});
			}
		}
	});
</script>
<script>
	var check_variant = true;
	var fIndex = false;
	var check_scrollstyle2 = '';
	var selectCallback = function(variant, selector) {
		if (variant){
			current_id = variant.id;
			if(variant.inventory_management == null){
				jQuery('.product-available').find(".txt-inventory").html('');
			}
			else{
				var inventoryQty = variant.inventory_quantity;
				if(inventoryQty == 0){
					jQuery('.product-available').find(".txt-inventory").html('Đã bán hết');
				}else{
					if (inventoryQty > 10){
						jQuery('.product-available').find(".txt-inventory").html('');
					}
					else{
						jQuery('.product-available').find(".txt-inventory").html('Đã bán gần hết');
					}
				}
			}
			if(variant.featured_image != null){
				//style 01
				if (pro_template == "style_01" || pro_template == "style_04"){
					var indeximg = $(".product-gallery[data-image='"+ Haravan.resizeImage(variant.featured_image.src,'master').replace('https:','')+"']").parent().index();
					$('#productCarousel-slider').trigger('to.owl.carousel', [indeximg, 500]);
					$('#productCarousel-thumb').find('.owl-item').removeClass('current');
					$('#productCarousel-thumb').find('.owl-item:nth-child('+ (indeximg + 1) +')').addClass('current');
				}		
				//style 02	
				if (pro_template == "style_02"){
					check_scrollstyle2 = Haravan.resizeImage(variant.featured_image.src,'master').replace('https:','');
					if ($(window).width() < 992){
						var indeximg_mb = $("#productCarousel-slider-mobile .product-gallery[data-image='"+ Haravan.resizeImage(variant.featured_image.src,'master').replace('https:','')+"']").parent().index();
						$('#productCarousel-slider-mobile').trigger('to.owl.carousel', [indeximg_mb, 500]);
					}
				}
				//style 03	
				if (pro_template == "style_03"){
					var indeximg = $(".product-gallery[data-image='"+ Haravan.resizeImage(variant.featured_image.src,'master').replace('https:','')+"']").index();	
					$('#productSlick-slider').slick('slickGoTo',indeximg);
					$('#productSlick-thumb').find('.slick-slide').removeClass('slick-current');
					$('#productSlick-thumb').find('.slick-slide:nth-child('+ (indeximg + 1) +')').addClass('slick-current');
				}
			}
			if(variant.sku != null ){
				jQuery('#pro_sku').html('Mã sản phẩm: ' + '<strong>' + variant.sku + '</strong> ');
			}		
			if(variant.price < variant.compare_at_price){
				var pro_sold = variant.price ;
				var pro_comp = variant.compare_at_price / 100;
				var sale = 100 - (pro_sold / pro_comp) ;
				var kq_sale = Math.round(sale);
				jQuery('.product-percent').html('<span class="pro-sale">-' + kq_sale + '%<br> OFF </span>');
				var html = '<span class="pro-title">Giá: </span>' + '<span class="pro-price">' + Haravan.formatMoney(pro_sold, "{{ shop.money_format }}") + '</span>' + '<del>' + Haravan.formatMoney(variant.compare_at_price, "{{ shop.money_format }}") + '</del>' + '<span class="pro-percent">-'+ kq_sale +'%</span>';	
				jQuery('#price-preview').html(html);

				$(".prod-info__price del").removeClass("d-none");
				$(".prod-info__price .prod-percent").removeClass("d-none");
				$(".prod-info__price .prod-price").html(Haravan.formatMoney(variant.price, "{{ shop.money_format }}"));
				$(".prod-info__price del").html(Haravan.formatMoney(variant.compare_at_price, "{{ shop.money_format }}"));
				$(".prod-info__price .prod-percent").html('-' + kq_sale + '%');
			} 
			else {
				jQuery('.product-percent').html('');
        $(".prod-info__price del").addClass("d-none");
				$(".prod-info__price .prod-percent").addClass("d-none");
				if(variant.price > 0) {
					jQuery('#price-preview').html("<span class='pro-title'>Giá: </span>" + "<span class='pro-price'>" + Haravan.formatMoney(variant.price, "{{ shop.money_format }}" + "</span>"));
					$(".prod-info__price .prod-price").html(Haravan.formatMoney(variant.price, "{{ shop.money_format }}"));
				} else {
					jQuery('#price-preview').html(`<span class='pro-title'>Giá: </span><a href="{{settings.prod_pricezero_link}}">{{settings.prod_pricezero_title}}</a></span>`);
					$(".prod-info__price .prod-price").html(`<a href="{{settings.prod_pricezero_link}}">{{settings.prod_pricezero_title}}</a>`);
				}
			}
			if (variant.available){
				jQuery('.productToolbar-addcart .add-to-cartProduct').removeAttr('disabled').removeClass('disabled').html("<span>Thêm vào giỏ</span>");
				jQuery('.addcart-area .btn-addtocart').removeAttr('disabled').removeClass('disabled').html("<span>Thêm vào giỏ</span>");
				jQuery('.addcart-area .btn-buynow').removeAttr('disabled').removeClass('disabled').html("<span>Mua ngay</span>");
				jQuery('#add-to-cart-sticky').removeAttr('disabled').removeClass('disabled').html("<span>Thêm vào giỏ</span>");

				jQuery('#detail-product .pro-soldold strong').text('Còn hàng');
				check_variant = true;
			} 
			else {
				jQuery('.productToolbar-addcart .add-to-cartProduct').addClass('disabled').attr('disabled', 'disabled').html("<span>Hết hàng</span>");
				jQuery('.addcart-area .btn-addtocart').attr('disabled', 'disabled').addClass('disabled').html("<span>Hết hàng</span>");
				jQuery('.addcart-area .btn-buynow').attr('disabled', 'disabled').addClass('disabled').html("<span>Mua ngay</span>");
				jQuery('#add-to-cart-sticky').attr('disabled', 'disabled').addClass('disabled').html("<span>Thêm vào giỏ</span>");

				var message = variant ? "Hết hàng" : "Không có hàng";
				jQuery('#detail-product .pro-soldold strong').text(message);
				check_variant = false;
			}
		}
		else{
			jQuery('.productToolbar-addcart .add-to-cartProduct').addClass('disabled').attr('disabled', 'disabled').html("<span>Hết hàng</span>");
			jQuery('.addcart-area .btn-addtocart').attr('disabled', 'disabled').addClass('disabled').html("<span>Hết hàng</span>");
			jQuery('.addcart-area .btn-buynow').attr('disabled', 'disabled').addClass('disabled').html("<span>Mua ngay</span>");
			jQuery('#add-to-cart-sticky').attr('disabled', 'disabled').addClass('disabled').html("<span>Thêm vào giỏ</span>");

			var message = "Hết hàng";
			jQuery('#detail-product .pro-soldold strong').text(message);
			check_variant = false;
		}
		return check_variant;
	};
	jQuery(document).ready(function($){
		{%if product.variants.size == 1 and product.variants.first.title contains 'Default'%}
		{%else%}
		//new Haravan.OptionSelectors("product-select", { product: {{ product | json }}, onVariantSelected: selectCallback });
		new Haravan.OptionSelectors("product-select", { product: {{ product | json }}, onVariantSelected: selectCallback, enableHistoryState: false });

		 {% if product.options.size == 1 and product.options.first != 'Tiêu đề' %}
		 $('#add-item-form .selector-wrapper:eq(0)').prepend('<label>{{ product.options.first }}</label>');
			{% endif %} 
			{%comment-%}//check variant available first - change
			{% assign found_one_in_stock = false %}
			{% for variant in product.variants %}
			{% if variant.available and found_one_in_stock == false %}
			{% assign found_one_in_stock = true %}
			{% for option in product.options %}
			$('#add-item-form .single-option-selector:eq({{ forloop.index0 }})').val({{ variant.options[forloop.index0] | json }}).trigger('change');
			 {% endfor %}
			 {% endif %}
			 {% endfor %}
			 {%endcomment-%}
			 $('#add-item-form .selector-wrapper select').each(function(){
				 $(this).wrap( '<span class="custom-dropdown custom-dropdown--white"></span>');
				 $(this).addClass("custom-dropdown__select custom-dropdown__select--white");
			 });
				{%endif%}
				});
</script>
<script>
	var swatch_size = parseInt($('#add-item-form .select-swatch .swatch').length);
	jQuery(document).on('click','#add-item-form .swatch input', function(e) { 
		e.preventDefault();
		var $this = $(this);
		var _available = '';
		var valueColor = $this.val();
		$(this).parents(".swatch").find(".pro-title strong").html( valueColor );

		$(this).parent().siblings().find('label').removeClass('sd');
		$(this).next().addClass('sd');
		var name = $this.attr('name');
		var value = $this.val();
		var valueHandle = $this.attr('data-vhandle');
		var selectFirst = $('#add-item-form-sb #select-swap-sb option:first').val();
		var checkColor = $(this).parents('.swatch').hasClass('is-color');
		var check_select_vrt = false;

		//var check_select_vrt = true;
		$('#add-item-form-sb [data-vhandle='+valueHandle+']').parent().siblings().find('label').removeClass('sd');
		$('#add-item-form-sb [data-vhandle='+valueHandle+']').next().addClass('sd');

		$('#add-item-form select[data-option='+name+']').val(value).trigger('change');
		if(!checkColor){$('.sidebar-action-bottom #add-item-form-sb #select-swap-sb').val(value);}

		if(swatch_size == 2){
			if(name.indexOf('1') != -1){
				$('#add-item-form #variant-swatch-1 .swatch-element').find('input').prop('disabled', false);
				$('#add-item-form #variant-swatch-2 .swatch-element').find('input').prop('disabled', false);
				$('#add-item-form #variant-swatch-1 .swatch-element label').removeClass('sd');
				$('#add-item-form #variant-swatch-1 .swatch-element').removeClass('soldout');

				$('#add-item-form-sb #select-swap-sb option').removeClass('disabled');
				$('#add-item-form-sb #select-swap-sb option').prop("disabled", false);

				$('#add-item-form-sb #variant-swatch-1-sb .swatch-element').find('input').prop('disabled', false);
				$('#add-item-form-sb #variant-swatch-2-sb .swatch-element').find('input').prop('disabled', false);
				$('#add-item-form-sb #variant-swatch-1-sb .swatch-element label').removeClass('sd');
				$('#add-item-form-sb #variant-swatch-1-sb .swatch-element').removeClass('soldout');
				$('#add-item-form .selector-wrapper .single-option-selector').eq(1).find('option').each(function(){
					var _tam = $(this).val();
					$(this).parent().val(_tam).trigger('change');
					if(check_variant){
						if(_available == '' ){
							_available = _tam;
						}
					}else{
						$('#add-item-form #variant-swatch-1 .swatch-element[data-value="'+_tam+'"]').addClass('soldout');
						$('#add-item-form #variant-swatch-1 .swatch-element[data-value="'+_tam+'"]').find('input').prop('disabled', true);

						$('#add-item-form-sb #variant-swatch-1-sb .swatch-element[data-value="'+_tam+'"]').addClass('soldout');
						$('#add-item-form-sb #variant-swatch-1-sb .swatch-element[data-value="'+_tam+'"]').find('input').prop('disabled', true);

						$('#add-item-form-sb #select-swap-sb option[value="'+ _tam +'"]').addClass('disabled');
						$('#add-item-form-sb #select-swap-sb option[value="'+ _tam +'"]').prop("disabled", true);

					}
				})
				$('#add-item-form .selector-wrapper .single-option-selector').eq(1).val(_available).trigger('change');
				$('#add-item-form #variant-swatch-1 .swatch-element[data-value="'+_available+'"] label').addClass('sd');

				$('#add-item-form-sb .selector-wrapper-sb .single-option-selector').eq(1).val(_available).trigger('change');
				$('#add-item-form-sb #variant-swatch-1-sb .swatch-element[data-value="'+_available+'"] label').addClass('sd');

				if(checkColor){
					$('#add-item-form-sb #select-swap-sb').val(_available);
				}else{
					$('#add-item-form-sb #select-swap-sb').eq(1).val(_available);
				}
			}
			if($('#add-item-form #variant-swatch-0 .swatch-element').find('label.sd').length != 0 && $('#add-item-form #variant-swatch-1 .swatch-element').find('label.sd').length != 0){
				check_select_vrt = true;
				check_variant_add = check_select_vrt;
				$(".check-action-tt").remove();
				$(".product-variants").removeClass("check-action-variant");
			}
			else{
				check_select_vrt = false;
				check_variant_add = check_select_vrt;
			}
		}
		else if (swatch_size == 3){
			var _count_op2 = $('#add-item-form #variant-swatch-1 .swatch-element').length;
			var _count_op3 = $('#add-item-form #variant-swatch-2 .swatch-element').length;
			if(name.indexOf('1') != -1){
				$('#add-item-form #variant-swatch-1 .swatch-element').find('input').prop('disabled', false);
				$('#add-item-form #variant-swatch-2 .swatch-element').find('input').prop('disabled', false);
				$('#add-item-form #variant-swatch-1 .swatch-element label').removeClass('sd');
				$('#add-item-form #variant-swatch-1 .swatch-element').removeClass('soldout');
				$('#add-item-form #variant-swatch-2 .swatch-element label').removeClass('sd');
				$('#add-item-form #variant-swatch-2 .swatch-element').removeClass('soldout');

				$('#add-item-form-sb #variant-swatch-1-sb .swatch-element').find('input').prop('disabled', false);
				$('#add-item-form-sb #variant-swatch-2-sb .swatch-element').find('input').prop('disabled', false);
				$('#add-item-form-sb #variant-swatch-1-sb .swatch-element label').removeClass('sd');
				$('#add-item-form-sb #variant-swatch-1-sb .swatch-element').removeClass('soldout');
				$('#add-item-form-sb #variant-swatch-2-sb .swatch-element label').removeClass('sd');
				$('#add-item-form-sb #variant-swatch-2-sb .swatch-element').removeClass('soldout');

				$('#add-item-form-sb #select-swap-sb option').removeClass('disabled');
				$('#add-item-form-sb #select-swap-sb option').prop("disabled", false);

				var _avi_op1 = '';
				var _avi_op2 = '';
				$('#add-item-form #variant-swatch-1 .swatch-element').each(function(ind,value){
					var _key = $(this).data('value');
					var _key2 = '';
					var _unavi = 0;
					$('#add-item-form .single-option-selector').eq(1).val(_key).change();
					$('#add-item-form #variant-swatch-2 .swatch-element label').removeClass('sd');
					$('#add-item-form #variant-swatch-2 .swatch-element').removeClass('soldout');
					$('#add-item-form #variant-swatch-2 .swatch-element').find('input').prop('disabled', false);

					$('#add-item-form-sb .single-option-selector').eq(1).val(_key).change();
					$('#add-item-form-sb #variant-swatch-2-sb .swatch-element label').removeClass('sd');
					$('#add-item-form-sb #variant-swatch-2-sb .swatch-element').removeClass('soldout');
					$('#add-item-form-sb #variant-swatch-2-sb .swatch-element').find('input').prop('disabled', false);

					$('#add-item-form #variant-swatch-2 .swatch-element').each(function(i,v){
						var _val = $(this).data('value');
						$('#add-item-form .single-option-selector').eq(2).val(_val).change();
						if(check_variant == true){
							if(_avi_op1 == ''){
								_avi_op1 = _key;
							}
							if(_avi_op2 == ''){
								_avi_op2 = _val;
							}
							//console.log(_avi_op1 + ' -- ' + _avi_op2)
						}else{
							_unavi += 1;
						}
					})
					if(_unavi == _count_op3){
						$('#add-item-form #variant-swatch-1 .swatch-element[data-value = "'+_key+'"]').addClass('soldout');
						$('#add-item-form #variant-swatch-2 .swatch-element').addClass('soldout');
						$('#add-item-form #variant-swatch-1 .swatch-element').find('label').removeClass('sd');
						$('#add-item-form #variant-swatch-2 .swatch-element').find('label').removeClass('sd');

						$('#add-item-form #variant-swatch-1 .swatch-element[data-value = "'+_key+'"] input').prop('disabled', true);
						$('#add-item-form #variant-swatch-2 .swatch-element input').prop('disabled',true);//add
						$('#add-item-form #variant-swatch-2 .swatch-element label').removeClass('sd');

						$('#add-item-form-sb #variant-swatch-1-sb .swatch-element[data-value = "'+_key+'"]').addClass('soldout');
						$('#add-item-form-sb #variant-swatch-1-sb .swatch-element[data-value = "'+_key+'"] input').attr('disabled','disabled');

						$('#add-item-form-sb #select-swap-sb option[value="'+ _key +'"]').addClass('disabled');
						$('#add-item-form-sb #select-swap-sb option[value="'+ _key +'"]').prop("disabled", true);
					}
				})
				$('#add-item-form #variant-swatch-1 .swatch-element[data-value="'+_avi_op1+'"] input').click();
				$('#add-item-form-sb #variant-swatch-1-sb .swatch-element[data-value="'+_avi_op1+'"] input').click();
			}
			else if(name.indexOf('2') != -1){
				$('#add-item-form #variant-swatch-2 .swatch-element label').removeClass('sd');
				$('#add-item-form #variant-swatch-2 .swatch-element').removeClass('soldout');
				$('#add-item-form #variant-swatch-2 .swatch-element').find('input').prop('disabled', false);

				$('#add-item-form-sb #variant-swatch-2-sb .swatch-element label').removeClass('sd');
				$('#add-item-form-sb #variant-swatch-2-sb .swatch-element').removeClass('soldout');
				$('#add-item-form-sb #variant-swatch-2-sb .swatch-element').find('input').prop('disabled', false);

				$('#add-item-form .selector-wrapper .single-option-selector').eq(2).find('option').each(function(){
					var _tam = $(this).val();
					$(this).parent().val(_tam).trigger('change');
					if(check_variant){
						if(_available == '' ){
							_available = _tam;
						}
					}else{
						$('#add-item-form #variant-swatch-2 .swatch-element[data-value="'+_tam+'"]').addClass('soldout');
						$('#add-item-form #variant-swatch-2 .swatch-element[data-value="'+_tam+'"]').find('input').prop('disabled', true);

						$('#add-item-form-sb #variant-swatch-2-sb .swatch-element[data-value="'+_tam+'"]').addClass('soldout');
						$('#add-item-form-sb #variant-swatch-2-sb .swatch-element[data-value="'+_tam+'"]').find('input').prop('disabled', true);

					}
				})
				$('#add-item-form .selector-wrapper .single-option-selector').eq(2).val(_available).trigger('change');
				$('#add-item-form #variant-swatch-2 .swatch-element[data-value="'+_available+'"] label').addClass('sd');

				$('#add-item-form-sb .selector-wrapper .single-option-selector').eq(2).val(_available).trigger('change');
				$('#add-item-form-sb #variant-swatch-2-sb .swatch-element[data-value="'+_available+'"] label').addClass('sd');
			}
			if($('#add-item-form #variant-swatch-0 .swatch-element').find('label.sd').length != 0 && $('#add-item-form #variant-swatch-1 .swatch-element').find('label.sd').length != 0 && $('#add-item-form #variant-swatch-2 .swatch-element').find('label.sd').length != 0){
				check_select_vrt = true;
				check_variant_add = check_select_vrt;
				$(".check-action-tt").remove();
				$(".product-variants").removeClass("check-action-variant");
			}
			else{
				check_select_vrt = false;
				check_variant_add = check_select_vrt;
			}
		}
		else{
			if($('#add-item-form #variant-swatch-0 .swatch-element').find('label.sd').length != 0){
				check_select_vrt = true;
				check_variant_add = check_select_vrt;
				$(".check-action-tt").remove();
				$(".product-variants").removeClass("check-action-variant");
			}
			else{
				check_select_vrt = false;
				check_variant_add = check_select_vrt;
			}
		}


		if(pro_template == "style_02"){
			//check img style 2
			if(check_scrollstyle2 != '' && $(window).width() > 991 ){
				var indeximg2 = $(".product-gallery__photo[data-image='"+ check_scrollstyle2 +"']").index();
				//console.log(indeximg2)
				window.scrollTo({ top: $('#productScroll-slider .product-gallery__photo:eq('+indeximg2+')').offset().top, behavior: 'smooth' });
			}
		}

		if(vrIdParam){	
			var urlsearch = window.location.search;
			if(current_id != selectedVariant.id){
				selectedVariant.id = current_id;
				if(urlsearch.indexOf('variant=') > -1 ){
					var newt = urlsearch.split('variant=');
					var t = newt[1].split('&');
					t[0] = current_id;
					newt[1] = t.join('&');
					newt = newt.join('variant=');
					/*	window.history.pushState({}, document.title, newt);	*/
					var newurl = newt;
					window.history.replaceState({
						path: newurl
					}, '', newurl);
				}
				else if(urlsearch != '?' && urlsearch != '' ){
					//window.history.pushState({}, document.title, urlsearch+"&variant=" + current_id);	
					var newurl = urlsearch+"&variant=" + current_id;
					window.history.replaceState({
						path: newurl
					}, '', newurl);
				}	
				else if(urlsearch == '' ){
					//window.history.pushState({}, document.title, "?variant=" + current_id);	
					var newurl = window.location.origin + window.location.pathname + '?variant=' + current_id;
					window.history.replaceState({
						path: newurl
					}, '', newurl);
				}
			}
			else if(urlsearch == '' ){
				//window.history.pushState({}, document.title, "?variant=" + current_id);	
				var newurl = window.location.origin + window.location.pathname + '?variant=' + current_id;
				window.history.replaceState({
					path: newurl
				}, '', newurl);
			}
		}
	})
	jQuery(document).on('click','.sidebar-action-bottom #add-item-form-sb .swatch input', function(e) {
		var valueHandle = $(this).attr('data-vhandle');
		$('#add-item-form .swatch input[data-vhandle="'+ valueHandle + '"]').trigger('click');
	});
	jQuery(document).on('change','.sidebar-action-bottom #add-item-form-sb #select-swap-sb', function(e) {
		var valueSelect = $(this).find("option:selected").attr('value');
		$('#add-item-form .swatch input[value="'+ valueSelect + '"]').trigger('click');
	});
	$(document).ready(function(){

		if(vrIdParam){
			var urlsearch2 = window.location.search;
			if(urlsearch2.indexOf('variant=') > -1 ){
				if(current_id == selectedVariant.id){
					$('#add-item-form .swatch-element[data-value="'+$('#add-item-form .selector-wrapper .single-option-selector').eq(0).val()+'"]').find('input').click();
					$('#add-item-form .swatch-element[data-value="'+$('#add-item-form .selector-wrapper .single-option-selector').eq(1).val()+'"]').find('input').click();
					$('#add-item-form .swatch-element[data-value="'+$('#add-item-form .selector-wrapper .single-option-selector').eq(2).val()+'"]').find('input').click();
					$('#add-item-form-sb #select-swap-sb').val($('#add-item-form .selector-wrapper .single-option-selector').eq(1).val());
				}
				else{
					$('#add-item-form .swatch-element[data-value="'+selectedVariant.option1+'"]').find('input').click();
					$('#add-item-form .swatch-element[data-value="'+selectedVariant.option2+'"]').find('input').click();
					$('#add-item-form .swatch-element[data-value="'+selectedVariant.option3+'"]').find('input').click();
					$('#add-item-form-sb #select-swap-sb').val(selectedVariant.option2);
				}
			}
		}
	});

	$(document).ready(function(){
		var vl = $('#add-item-form .swatch .color input').val();
		//$('#add-item-form .swatch .color input').parents(".swatch").find(".header strong").html(vl);
		$("#add-item-form .select-swap .color" ).hover(function() { 
			//var value = $( this ).data("value");
			//$(this).parents(".swatch").find(".header strong").html( value );
		},function(){
			var value = $("#add-item-form .select-swap .color label.sd span").html();
			$(this).parents(".swatch").find(".header strong").html( value );
		});

		if (has360){
			if(data_360 != null){
				data_360["image360"].map(x => {
					$('#div_360,#div_360_mb').append('<img src="'+x+'" />');

				});
				$('#div_360,#div_360_mb').angle({
					speed: 3,
					drag: false
				});
			}
		}


	});
</script>
<script>
	$(document).ready(function(){
		$('.js-btn-preorder-detail').click(function(e){
			e.preventDefault();
			if(!check_variant_add && swatch_size !=0 ){
				if($(".product-variants.check-action-variant").length == 0){
					$(".product-variants").prepend("<p class='check-action-tt'>Vui lòng chọn biến thể</p>");
					$(".sidebar-action-bottom #add-item-form-sb").prepend("<p class='check-action-tt'>Vui lòng chọn biến thể</p>");
					$(".product-variants").addClass("check-action-variant");
				}
				else{
					$('.check-action-tt').removeClass('text-effect');
					setTimeout(function(){
						$('.check-action-tt').addClass('text-effect');
					}, 100);
				}
			}
			else{
				$('#modal-preorder-contact').modal('show');
			}
		});
		$('#modal-preorder-contact form.contact-form').submit(function(e){
			e.preventDefault();
			var self = $(this);
			$('#modal-preorder-contact input.detailPr').val('');

			var vlTextbody = self.find('textarea.product-body-val').val() + '\n';
			var handlePr = window.location.href;
			var vlTextPr = self.find('input.detailPr').attr('product-name') + '\n' + 'Link sản phẩm: '+handlePr;		
			var swatchSize = parseInt($('#add-item-form .select-swatch .swatch').length);
			if(swatchSize == 1){
				var vlVariant = 'Biến thể: '+$('#add-item-form .select-swatch .swatch').find('label.sd span').html();				
			}
			else if(swatchSize == 2){
				var vlVariant = 'Biến thể: '+$('#add-item-form .select-swatch .swatch').find('label.sd span').html()+' | '+
						$('#add-item-form .select-swatch .swatch').next().find('label.sd span').html();
			}
			else if(swatchSize == 3){
				var vlVariant = 'Biến thể: '+$('#add-item-form .select-swatch .swatch').find('label.sd span').html()+' | '+
						$('#add-item-form .select-swatch .swatch').next().find('label.sd span').html()+' | '+
						$('#add-item-form .select-swatch .swatch').next().next().find('label.sd span').html();				
			}
			else{
				var vlVariant = '';
			}
			$('#modal-preorder-contact input.detailPr').val(vlTextbody+'\n'+vlTextPr+'\n'+vlVariant);

			grecaptcha.ready(function() {
				grecaptcha.execute('6Le047YqAAAAAKk-dTuIhf_F7L0m3Yp9hOkIxTn1', {action: 'submit'}).then(function(token) {
					self.find('input[name="g-recaptcha-response"]').val(token);
					$.ajax({
						type: 'POST',
						url:'/contact',
						data: $('#modal-preorder-contact form.contact-form').serialize(),			 
						success:function(data){		
							if($(data).find('#preorder-form-success').length > 0){
								$('#modal-preorder-contact .btn-submit-contact-pr').css('pointer-events','none');
								$('#modal-preorder-contact form.contact-form #preorder-form-alert').html('Cảm ơn bạn đã liên hệ với chúng tôi!')
								$('#modal-preorder-contact form.contact-form #preorder-form-alert').removeClass('alert-danger').addClass('alert-success');
								$('#modal-preorder-contact form.contact-form #preorder-form-alert').slideDown();
								setTimeout(function(){
									$('#modal-preorder-contact').modal('hide');
									$('#modal-preorder-contact').on('hidden.bs.modal', function(e) { 
										location.reload();
									});
								},4000)
							}
							else{
								$('#modal-preorder-contact form.contact-form #preorder-form-alert').html('Thông tin bạn nhập chưa chính xác. Vui lòng kiểm tra lại!')
								$('#modal-preorder-contact form.contact-form #preorder-form-alert').removeClass('alert-success').addClass('alert-danger');
								$('#modal-preorder-contact form.contact-form #preorder-form-alert').slideDown();
							}
						}			
					})
				});
			});
		});
	});
</script>
{%if settings.promotion_hrvapp_use and settings.promotion_hrvapp == 'appbuyxgety' -%}
<script>
	$(document).ready(function(){
		$('#add-to-cart').click(function(e){	
			if(!check_variant_add && swatch_size !=0 ){
				if($(".product-variants.check-action-variant").length == 0){
					$(".product-variants").prepend("<p class='check-action-tt'>Vui lòng chọn biến thể</p>");
					$(".sidebar-action-bottom #add-item-form-sb").prepend("<p class='check-action-tt'>Vui lòng chọn biến thể</p>");
					$(".product-variants").addClass("check-action-variant");
				}
				else{
					$('.check-action-tt').removeClass('text-effect');
					setTimeout(function(){
						$('.check-action-tt').addClass('text-effect');
					}, 100);
				}
			}
			else {
				e.preventDefault();
				var variant_id = $('#product-select').val(),
						quantity = $('#quantity').val(),
						title = $('.productDetail--content .product-heading h1').html();
				buyXgetY.addCartBuyXGetY_detail(false,variant_id,currentId,quantity,title,"normal",function(){
					HRT.All.getCartModal();	
					//console.log(1)
					//if($(window).width() < 992){
					$('body').removeClass('locked-scroll').addClass('body-showcart');
					$('.sidebar-main').addClass('is-show-right');
					$('.sidebar-main .sitenav-cart').addClass('show');
					//}
				});
			}
		});	
		$('#buy-now').click(function(e){	
			if(!check_variant_add && swatch_size !=0 ){
				if($(".product-variants.check-action-variant").length == 0){
					$(".product-variants").prepend("<p class='check-action-tt'>Vui lòng chọn biến thể</p>");
					$(".sidebar-action-bottom #add-item-form-sb").prepend("<p class='check-action-tt'>Vui lòng chọn biến thể</p>");
					$(".product-variants").addClass("check-action-variant");
				}
				else{
					$('.check-action-tt').removeClass('text-effect');
					setTimeout(function(){
						$('.check-action-tt').addClass('text-effect');
					}, 100);
				}
			}
			else {
				e.preventDefault();
				var variant_id = $('#product-select').val(),
						quantity = $('#quantity').val(),
						title = $('.productDetail--content .product-heading h1').html();
				buyXgetY.addCartBuyXGetY_detail(false,variant_id,currentId,quantity,title,"normal buynow",function(){
					window.location = "/cart";
				});
			}
		});		
	});
</script>
{%else-%}
<script>
	$(document).ready(function(){
		$('#add-to-cart').click(function(e){	
			if(!check_variant_add && swatch_size !=0 ){
				if($(".product-variants.check-action-variant").length == 0){
					$(".product-variants").prepend("<p class='check-action-tt'>Vui lòng chọn biến thể</p>");
					$(".sidebar-action-bottom #add-item-form-sb").prepend("<p class='check-action-tt'>Vui lòng chọn biến thể</p>");
					$(".product-variants").addClass("check-action-variant");
				}
				else{
					$('.check-action-tt').removeClass('text-effect');
					setTimeout(function(){
						$('.check-action-tt').addClass('text-effect');
					}, 100);
				}
			}
			else{
				e.preventDefault();			
				$(this).addClass('clicked_buy');
				HRT.All.addItemShowModalCart($('#product-select').val());
				if($(window).width() < 992){
					$('body').removeClass('locked-scroll').addClass('body-showcart');
					$('.sidebar-main').addClass('is-show-right');
					$('.sidebar-main .sitenav-cart').addClass('show');
				}
			}
		});
		$('#buy-now').click(function(e){	
			if(!check_variant_add && swatch_size !=0 ){
				if($(".product-variants.check-action-variant").length == 0){
					$(".product-variants").prepend("<p class='check-action-tt'>Vui lòng chọn biến thể</p>");
					$(".sidebar-action-bottom #add-item-form-sb").prepend("<p class='check-action-tt'>Vui lòng chọn biến thể</p>");
					$(".product-variants").addClass("check-action-variant");
				}
				else{
					$('.check-action-tt').removeClass('text-effect');
					setTimeout(function(){
						$('.check-action-tt').addClass('text-effect');
					}, 100);
				}
			}
			else{
				e.preventDefault() ;
				var id = $('#product-select').val();
				var quantity = $('#quantity').val();
				var params = {
					type: 'POST',
					url: '/cart/add.js',
					async : false,
					data: 'quantity=' + quantity + '&id=' + id,
					dataType: 'json',
					success: function(line_item) {
						window.location = '/cart';
					},
					error: function(XMLHttpRequest, textStatus) {
						Haravan.onError(XMLHttpRequest, textStatus);
					}
				};
				jQuery.ajax(params);
			}
		});
	});
</script>
{%endif-%}